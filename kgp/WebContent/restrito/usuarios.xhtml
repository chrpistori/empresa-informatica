<?xml version="1.0" encoding="ISO-8859-1"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui"
	xmlns:c="http://java.sun.com/jsp/jstl/core">

<ui:composition template="/templates/principal.xhtml">

	<ui:define name="titulo">
		KGP - Usuários Cadastrados
	</ui:define>

	<ui:define name="corpo">
		<div id="three-columns">
			<div class="content">

				<h:form id="frmUsuarios">
					<p:growl id="messages" sticky="false" time="3000" globalOnly="true" />
					<p:outputLabel value="Usuários" styleClass="titulo" />
					<br />
					<br />
					<p:commandButton value="Novo Usuário"
						action="usuario?faces-redirect=true"
						rendered="#{principalController.renderAdmGer()}"
						style="margin-bottom: 20px;" />
					<p:growl sticky="false" time="3000" globalOnly="true" />
					<p:dataTable id="dt_usuario" var="usuario"
						value="#{usuarioConsultaController.lista}" paginator="true"
						resizableColumns="true"
						emptyMessage="Não foram encontrados resultados."
						paginatorPosition="bottom" rows="10"
						selection="#{usuarioConsultaController.usuario}"
						selectionMode="single" rowKey="#{usuario.id}">
						<f:facet name="header">
							<h:outputText value="Membros de Equipe" />
						</f:facet>
						<p:column sortBy="#{usuario.nome}" headerText="Nome">
							<h:outputText value="#{usuario.nome}" />
						</p:column>
						<p:column sortBy="#{usuario.email}" headerText="E-mail">
							<h:outputText value="#{usuario.email}" />
						</p:column>
						<p:column sortBy="#{usuario.usuario}" headerText="Usuário">
							<h:outputText value="#{usuario.usuario}" />
						</p:column>
						<p:column sortBy="#{usuario.telefone1}" headerText="Telefone 1">
							<h:outputText value="#{usuario.telefone1}" />
						</p:column>
						<p:column sortBy="#{usuario.telefone2}" headerText="Telefone 2">
							<h:outputText value="#{usuario.telefone2}" />
						</p:column>
						<p:column styleClass="dataTable_options"
							rendered="#{principalController.renderAdmGer()}">
							<p:commandLink update=":frmEdit:pgEditar"
								actionListener="#{usuarioEditController.preparar(usuario.id)}"
								oncomplete="dlgEditar.show();" title="Editar">
								<p:graphicImage url="../resources/imagens/editar2.png" />
							</p:commandLink>
						</p:column>
						<p:column styleClass="dataTable_options"
							rendered="#{principalController.renderAdmGer()}">
							<p:commandLink update=":frmExcluir"
								actionListener="#{usuarioEditController.preparar(usuario.id)}"
								ajax="true" immediate="false" oncomplete="dlgExcluir.show();"
								title="Excluir">
								<p:graphicImage url="../resources/imagens/excluir2.png" />
							</p:commandLink>
						</p:column>
					</p:dataTable>

					<p:dataTable id="dt_gerente" var="usuario"
						value="#{usuarioConsultaController.listaGerentes}"
						paginator="true" resizableColumns="true" style="margin-top: 20px;"
						emptyMessage="Não foram encontrados resultados."
						paginatorPosition="bottom" rows="10"
						selection="#{usuarioConsultaController.usuario}"
						selectionMode="single" rowKey="#{usuario.id}">
						<f:facet name="header">
							<h:outputText value="Gerentes" />
						</f:facet>
						<p:column sortBy="#{usuario.nome}" headerText="Nome">
							<h:outputText value="#{usuario.nome}" />
						</p:column>
						<p:column sortBy="#{usuario.email}" headerText="E-mail">
							<h:outputText value="#{usuario.email}" />
						</p:column>
						<p:column sortBy="#{usuario.usuario}" headerText="Usuário">
							<h:outputText value="#{usuario.usuario}" />
						</p:column>
						<p:column sortBy="#{usuario.telefone1}" headerText="Telefone 1">
							<h:outputText value="#{usuario.telefone1}" />
						</p:column>
						<p:column sortBy="#{usuario.telefone2}" headerText="Telefone 2">
							<h:outputText value="#{usuario.telefone2}" />
						</p:column>
						<p:column styleClass="dataTable_options"
							rendered="#{principalController.renderAdmGer()}">
							<p:commandLink update=":frmEdit:pgEditar"
								actionListener="#{usuarioEditController.preparar(usuario.id)}"
								oncomplete="dlgEditar.show();" title="Editar">
								<p:graphicImage url="../resources/imagens/editar2.png" />
							</p:commandLink>
						</p:column>
						<p:column styleClass="dataTable_options"
							rendered="#{principalController.renderAdmGer()}">
							<p:commandLink update=":frmExcluir"
								actionListener="#{usuarioEditController.preparar(usuario.id)}"
								ajax="true" immediate="false" oncomplete="dlgExcluir.show();"
								title="Excluir">
								<p:graphicImage url="../resources/imagens/excluir2.png" />
							</p:commandLink>
						</p:column>
					</p:dataTable>
				</h:form>

				<h:form id="frmEdit">
					<p:dialog header="Editar Usuário" widgetVar="dlgEditar"
						resizable="false" id="dlgEditar" modal="true">
						<p:growl id="growlEditar" sticky="false" />
						<h:panelGrid id="pgEditar" columns="3" cellpadding="4"
							style="margin:0 auto;">
							<h:inputHidden value="#{usuarioEditController.usuario.id}"
								id="hiddenid" />

							<p:outputLabel value="Nome:" />
							<p:inputText id="nome" label="Nome"
								value="#{usuarioEditController.usuario.nome}" size="30"
								maxlength="30" required="true"
								requiredMessage="Campo Obrigatório" />
							<p:message for="nome" display="text" />

							<p:outputLabel value="E-mail:" />
							<p:inputText id="email" label="E-mail"
								value="#{usuarioEditController.usuario.email}" size="30"
								maxlength="30" required="true"
								requiredMessage="Campo Obrigatório"
								validatorMessage="Formato de e-mail inválido">
								<f:validateRegex
									pattern="^[_A-Za-z0-9-\+]+(\.[_A-Za-z0-9-]+)*@[A-Za-z0-9-]+(\.[A-Za-z0-9]+)*(\.[A-Za-z]{2,})$" />
							</p:inputText>
							<p:message for="email" display="text" />

							<p:outputLabel value="Telefone 1:" />
							<p:inputMask id="telefone1" mask="(99) 9999-9999"
								value="#{usuarioEditController.usuario.telefone1}" size="30"
								maxlength="15" />
							<p:message for="telefone1" display="text" />

							<p:outputLabel value="Telefone 2:" />
							<p:inputMask id="telefone2" mask="(99) 9999-9999"
								value="#{usuarioEditController.usuario.telefone2}" size="30"
								maxlength="15" />
							<p:message for="telefone2" display="text" />

							<p:outputLabel value="Usuário:" />
							<p:inputText id="usuario" label="Usuario"
								value="#{usuarioEditController.usuario.usuario}" size="30"
								maxlength="30" required="true"
								requiredMessage="Campo Obrigatório" />
							<p:message for="usuario" display="text" />

							<p:outputLabel value="Perfil:" />
							<p:selectOneMenu id="perfil"
								value="#{usuarioEditController.usuario.perfil}" required="true"
								requiredMessage="Campo Obrigatório">
								<c:if test="#{loginController.usuarioLogado.perfil == 1}">
									<f:selectItem itemLabel="Gerente" itemValue="2" />
								</c:if>




								<f:selectItem itemLabel="Membro da Equipe" itemValue="3" />
							</p:selectOneMenu>
							<p:message for="perfil" display="text" />
						</h:panelGrid>
						<p:separator />
						<h:panelGrid columns="2"
							style="margin-left: 50px; margin-top: 20px; width: 90%">
							<p:commandButton value="Atualizar"
								update=":frmUsuarios:dt_usuario, :frmUsuarios:dt_gerente, growlEditar, dlgEditar"
								actionListener="#{usuarioEditController.atualizar()}"
								ajax="true" oncomplete="dlgEditar.hide()" />
							<p:commandButton value="Cancelar" onclick="dlgEditar.hide()" />
						</h:panelGrid>
					</p:dialog>
				</h:form>

				<h:form id="frmExcluir">
					<p:growl id="growlExcluir" sticky="true" />
					<p:confirmDialog id="dlgExcluir"
						message="Deseja excluir este usuário?" header="Excluir Usuário"
						severity="alert" widgetVar="dlgExcluir">
						<h:inputHidden value="#{usuarioEditController.usuario.id}"
							id="hiddenid" />
						<p:commandButton value="Excluir"
							update=":frmUsuarios:dt_usuario, :frmUsuarios:dt_gerente, growlExcluir, dlgExcluir"
							actionListener="#{usuarioEditController.excluir()}"
							oncomplete="dlgExcluir.hide()" />
						<p:commandButton value="Cancelar" onclick="dlgExcluir.hide()" />

					</p:confirmDialog>

				</h:form>

			</div>
		</div>
	</ui:define>
</ui:composition>
</html>